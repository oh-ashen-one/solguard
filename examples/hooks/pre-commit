#!/bin/sh
# SolGuard Pre-Commit Hook
# Add to .git/hooks/pre-commit to audit before each commit

# Find changed Rust files
RUST_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.rs$')

if [ -z "$RUST_FILES" ]; then
    exit 0
fi

echo "üõ°Ô∏è Running SolGuard security check..."

# Run quick check (fail on critical/high)
solguard check . --fail-on high --quiet

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå Security issues found! Run 'solguard audit .' for details."
    echo "   Use 'git commit --no-verify' to bypass (not recommended)."
    exit 1
fi

echo "‚úÖ Security check passed!"
exit 0
